<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Paw Care Veterinary Clinic</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    body{font-family:'Poppins',sans-serif}
    .shadow-soft{box-shadow:0 4px 16px rgba(0,0,0,.05)}
    :root{--soft-teal:#199e9e}
  </style>
</head>
<body class="min-h-screen bg-[#f6f9f9] flex flex-col">
  <!-- Header -->
  <header class="w-full bg-[var(--soft-teal)] text-white flex items-center justify-between px-12 py-4 shadow-soft">
    <div class="flex items-center space-x-5">
      <img src="assets/logo.png" alt="Paw Care Logo" class="w-16 h-16 rounded-lg bg-white p-1 object-contain">
      <div>
        <h1 class="text-2xl font-semibold leading-tight">Paw Care Veterinary Clinic</h1>
        <p class="text-sm text-gray-100/90">Caring for your pets with compassion and expertise</p>
      </div>
    </div>
    <span class="text-sm text-gray-100/90">696 J. Delovino Street, Parañaque City • (02) 522 8080</span>
  </header>

  <!-- Main -->
<main class="flex-1 flex items-center justify-center p-6 bg-cover bg-center" 
      style="background-image: url('assets/bg.jpg');">
    <div class="w-full max-w-5xl bg-white rounded-2xl shadow-soft p-10 grid md:grid-cols-2 gap-10">
      <!-- Left: Role selection -->
      <div>
        <h2 class="text-3xl font-semibold text-gray-800 mb-2">Welcome to Paw Care</h2>
        <p class="text-gray-600 mb-6 text-lg">Select a role, then sign in with that role’s credentials.</p>

        <div id="roleButtons" class="grid grid-cols-2 gap-3 mb-4">
          <button data-role="admin" class="role-btn px-5 py-4 border border-gray-300 rounded-lg text-lg text-gray-700 hover:bg-[var(--soft-teal)] hover:text-white">Admin</button>
          <button data-role="vet" class="role-btn px-5 py-4 border border-gray-300 rounded-lg text-lg text-gray-700 hover:bg-[var(--soft-teal)] hover:text-white">Vet</button>
          <button data-role="receptionist" class="role-btn px-5 py-4 border border-gray-300 rounded-lg text-lg text-gray-700 hover:bg-[var(--soft-teal)] hover:text-white">Receptionist</button>
          <button data-role="pharmacist" class="role-btn px-5 py-4 border border-gray-300 rounded-lg text-lg text-gray-700 hover:bg-[var(--soft-teal)] hover:text-white">Pharmacist</button>
        </div>
        
 
        <div class="rounded-xl bg-[#f7fbfb] border border-gray-200 p-4 text-sm text-gray-700">
          <div class="font-semibold mb-2"><center>"Pawsitively the Best!"</center></div>
        </div>
      </div>

      <!-- Right: Login form -->
      <div class="border-l border-gray-200 pl-10">
        <h3 class="text-2xl font-semibold text-gray-800 mb-5">Sign In</h3>

        <div class="mb-3">
          <label class="text-sm text-gray-600">Selected Role</label>
          <input id="selectedRole" class="w-full border border-gray-300 rounded-md p-3 mt-1 bg-gray-50 text-gray-700" placeholder="Pick a role on the left" readonly>
        </div>

        <div class="mb-3">
          <label class="text-sm text-gray-600">Username</label>
          <input id="username" type="text" autocomplete="username"
                 class="w-full border border-gray-300 rounded-md p-3 mt-1 text-lg focus:outline-none focus:ring-2 focus:ring-[var(--soft-teal)]">
        </div>

        <div class="mb-5">
          <label class="text-sm text-gray-600">Password</label>
          <div class="flex gap-2">
            <input id="password" type="password" autocomplete="current-password"
                   class="flex-1 border border-gray-300 rounded-md p-3 mt-1 text-lg focus:outline-none focus:ring-2 focus:ring-[var(--soft-teal)]">
            <button id="togglePw" class="mt-1 px-3 border rounded-md text-gray-700 hover:bg-gray-50">Show</button>
          </div>
        </div>

        <div id="errorBox" class="hidden mb-4 p-3 rounded-md bg-red-50 border border-red-200 text-red-700 text-sm"></div>

        <div class="flex gap-4">
          <button id="loginBtn" class="bg-[var(--soft-teal)] hover:brightness-90 text-white px-8 py-3 rounded-md text-lg shadow">Log In</button>
          <button id="clearBtn" class="border border-gray-300 px-8 py-3 rounded-md text-lg text-gray-700 hover:bg-gray-50">Clear</button>
        </div>
      </div>
    </div>
  </main>

  <script src="assets/api.js"></script>
  <script src="assets/app.js"></script>
  <script>
    // UI wiring for role selection and login
    const roleBtns = document.querySelectorAll('.role-btn');
    const selectedRoleInput = document.getElementById('selectedRole');
    const errorBox = document.getElementById('errorBox');
    const togglePw = document.getElementById('togglePw');
    let selectedRole = null;

    roleBtns.forEach(btn=>{
      btn.addEventListener('click', (e)=>{
        roleBtns.forEach(b=>b.classList.remove('ring-2','ring-[var(--soft-teal)]','bg-[var(--soft-teal)]','text-white'));
        e.currentTarget.classList.add('ring-2','ring-[var(--soft-teal)]','bg-[var(--soft-teal)]','text-white');
        selectedRole = e.currentTarget.dataset.role;
        selectedRoleInput.value = selectedRole.toUpperCase();
        errorBox.classList.add('hidden');
      });
    });

    togglePw.addEventListener('click', ()=>{
      const p = document.getElementById('password');
      p.type = p.type === 'password' ? 'text' : 'password';
      togglePw.textContent = p.type === 'password' ? 'Show' : 'Hide';
    });

    document.getElementById('clearBtn').onclick = ()=>{
      document.getElementById('username').value='';
      document.getElementById('password').value='';
      errorBox.classList.add('hidden');
    };

    async function doLogin(){
      const u = document.getElementById('username').value.trim();
      const p = document.getElementById('password').value;
      
      if (!u || !p) {
        errorBox.textContent = "Please enter username and password";
        errorBox.classList.remove('hidden');
        return;
      }
      
      // Disable login button during request
      const loginBtn = document.getElementById('loginBtn');
      loginBtn.disabled = true;
      loginBtn.textContent = 'Logging in...';
      
      try {
        console.log('Starting login for:', u);
      const res = await window.tryLogin(u, p, selectedRole);
        console.log('Login result:', res);
        
        if(res && res.ok){
          console.log('Login successful, redirecting to dashboard...');
          // Small delay to ensure localStorage is saved
          setTimeout(() => {
        location.href = 'dashboard.html';
          }, 100);
      }else{
          errorBox.textContent = res?.msg || "Login failed. Please check console for details.";
          errorBox.classList.remove('hidden');
          loginBtn.disabled = false;
          loginBtn.textContent = 'Login';
        }
      } catch (err) {
        console.error('Login error:', err);
        errorBox.textContent = err.message || "An error occurred during login. Check console for details.";
        errorBox.classList.remove('hidden');
        loginBtn.disabled = false;
        loginBtn.textContent = 'Login';
      }
    }
    document.getElementById('loginBtn').onclick = doLogin;
    // Enter to login on inputs
    document.addEventListener('keydown', (e)=>{
      if(e.key==='Enter'){
        e.preventDefault();
        doLogin();
      }
    });
  </script>
</body>
</html>
